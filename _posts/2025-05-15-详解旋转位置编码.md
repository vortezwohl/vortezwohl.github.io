旋转位置编码（Rotary Position Embedding, RoPE）是一种新颖的位置编码方法，旨在更有效地将位置信息集成到Transformer模型中。它通过旋转查询（Query）和键（Key）向量来注入绝对位置信息，同时巧妙地在自注意力机制中实现了相对位置编码。

> RoPE 最初由 Jianlin Su 等人在论文 "RoFormer: Enhanced Transformer with Rotary Position Embedding" (arXiv:2104.09864) 中提出。这篇论文详细阐述了 RoPE 的数学原理、实现方式以及其在各种自然语言处理任务中的优势。

## 传统位置编码的局限性

在 RoPE 之前, 位置编码的普遍策略是**正余弦位置编码 (Sinusoidal Position Encoding)**. 对于一个给定位置 $pos$ 和维度索引 $i$ (其中 $i$ 从 0 到 $d - 1$, $d$ 是嵌入的维度), 位置编码 $PE_{(pos, i)}$ 的计算方式如下: 

$$
PE_{(pos, 2k)} = sin(\frac{pos}{10000^{\frac{2k}{d}}})
$$

$$
PE_{(pos, 2k+1)} = cos(\frac{pos}{10000^{\frac{2k}{d}}})
$$

其中, $pos$ 是 token 在序列中的位置, $k$ 是维度索引的一半, 因为正弦和余弦成对出现, $d$ 是位置编码的维度 (通常和嵌入维度相同).